# Модуль Security API

## Обзор

Модуль Security API управляет аутентификацией, контролем доступа и управлением PIN для устройств HiLink. Это включает операции с PIN SIM-карты, аутентификацию пользователей и настройки безопасности устройства.

## Содержание

- [Модуль PIN](#модуль-pin)
- [Модуль Security](#модуль-security)
- [Модуль User](#модуль-user)
- [Обработка ошибок](#обработка-ошибок)
- [Лучшие практики](#лучшие-практики)

## Модуль PIN

### Операции с PIN

Модуль PIN управляет проверкой PIN SIM-карты и операциями управления.

**Примечание**: Операции с PIN являются критичными функциями безопасности. Неправильный ввод PIN может заблокировать SIM-карту.

#### Коды статуса PIN

| Код | Описание | Требуемое действие |
|-----|----------|-------------------|
| `0` | PIN не требуется | Отсутствует |
| `1` | Требуется PIN | Ввести PIN |
| `2` | Требуется PUK | Ввести PUK и новый PIN |
| `3` | PIN заблокирован | Обратиться к оператору |

#### Общие конечные точки PIN

Хотя конкретные конечные точки PIN различаются в зависимости от прошивки, типичные операции включают:

- **Проверка статуса PIN**: Определить, требуется ли ввод PIN
- **Ввод PIN**: Разблокировать SIM с помощью PIN
- **Изменение PIN**: Изменить существующий PIN
- **Включение/отключение PIN**: Переключить требование PIN
- **Ввод PUK**: Разблокировать заблокированную SIM с помощью PUK

### Коды ошибок PIN

| Код | Описание | Оставшиеся попытки |
|-----|----------|-------------------|
| `112001` | Неправильный PIN | 2 попытки |
| `112002` | Требуется PUK | PIN заблокирован |
| `112003` | PUK заблокирован | Обратиться к оператору |
| `112004` | Ошибка аутентификации PUK | Уменьшено |
| `112005` | PUK заблокирован навсегда | Восстановление невозможно |
| `112006` | Карта заблокирована | Аппаратная проблема |

## Модуль Security

### Настройки безопасности

Настройки безопасности контролируют доступ к устройству и требования аутентификации.

#### Контроль доступа

Типичные конечные точки безопасности включают:

- **Статус аутентификации**: Проверка требований входа
- **Управление сессиями**: Обработка пользовательских сессий
- **Разрешения доступа**: Контроль доступа к функциям
- **Политики безопасности**: Настройка правил безопасности

#### Конфигурация безопасности

Настройки безопасности могут включать:

- **Политики паролей**: Минимальная длина, сложность
- **Тайм-ауты сессий**: Периоды автоматического выхода
- **Ограничения доступа**: Ограничения на основе IP
- **Блокировки функций**: Отключение определенных функций

### Управление входом в систему

#### Поток аутентификации пользователя

1. **Проверка статуса аутентификации**
2. **Отправка учетных данных при необходимости**
3. **Получение токена сессии/cookie**
4. **Включение аутентификации в последующие запросы**
5. **Обработка истечения сессии**

#### Безопасность сессии

- **Токены сессии**: Временная аутентификация
- **Тайм-аут сессии**: Автоматическое истечение
- **Одновременные сессии**: Поддержка нескольких пользователей
- **Проверка сессии**: Проверка токенов

## Модуль User

### Управление пользователями

Модуль User обрабатывает учетные записи пользователей устройства и разрешения.

#### Типы пользователей

| Тип | Разрешения | Описание |
|-----|------------|----------|
| `Admin` | Полный доступ | Полное управление устройством |
| `User` | Ограниченный доступ | Только базовые операции |
| `Guest` | Только чтение | Только просмотр статуса |

#### Операции с пользователями

Общие операции управления пользователями:

- **Список пользователей**: Перечисление учетных записей пользователей
- **Добавление пользователя**: Создание новой учетной записи
- **Изменение пользователя**: Изменение разрешений/пароля
- **Удаление пользователя**: Удаление учетной записи
- **Текущий пользователь**: Проверка вошедшего пользователя

### Управление пользовательскими сессиями

#### Информация о сессии

Типичные детали сессии включают:

- **Имя пользователя**: Текущий вошедший пользователь
- **ID сессии**: Уникальный идентификатор сессии
- **Время входа**: Временная метка начала сессии
- **Последняя активность**: Время недавней активности
- **Разрешения**: Уровень доступа пользователя

## Обработка ошибок

### Ошибки аутентификации

| Код | Описание | Решение |
|-----|----------|---------|
| `100008` | Неправильный пароль | Проверить учетные данные |
| `100009` | Не выполнен вход | Сначала аутентифицироваться |
| `108001` | Неверное имя пользователя | Проверить имя пользователя |
| `108002` | Неверный пароль | Проверить пароль |
| `108003` | Пользователь уже вошел | Использовать существующую сессию |
| `108006` | Неверные учетные данные | Проверить имя пользователя/пароль |
| `108007` | Слишком много пользователей | Дождаться истечения сессии |
| `125001` | Неверный токен | Повторно аутентифицироваться |

### Ошибки PIN

| Код | Описание | Действие |
|-----|----------|----------|
| `109005` | Неправильный PIN | Повторить с правильным PIN |
| `112001` | Неправильный PIN | Осталось 2 попытки |
| `112002` | Требуется PUK | Использовать PUK для разблокировки |
| `112003` | PUK заблокирован | Обратиться к оператору |

## Лучшие практики

### Управление PIN

1. **Безопасное хранение PIN**: Никогда не храните PIN в открытом виде
2. **Проверка PIN**: Проверяйте формат PIN перед отправкой
3. **Мониторинг попыток**: Отслеживайте неудачные попытки PIN
4. **Обработка PUK**: Осторожно реализуйте ввод PUK
5. **Связь с оператором**: Направляйте пользователей к оператору для проблем с PUK

### Безопасность аутентификации

1. **Сильные пароли**: Обеспечивайте сложность паролей
2. **Управление сессиями**: Реализуйте правильную обработку сессий
3. **Безопасность токенов**: Защищайте токены аутентификации
4. **Обработка тайм-аутов**: Реализуйте автоматический выход
5. **Обработка ошибок**: Не раскрывайте чувствительную информацию

### Сетевая безопасность

1. **HTTPS**: Используйте шифрование при возможности
2. **VPN**: Рассмотрите VPN для удаленного доступа
3. **Брандмауэр**: Реализуйте защиту на сетевом уровне
4. **Контроль доступа**: Ограничьте доступ к API по IP
5. **Мониторинг**: Ведите журнал событий безопасности

## Примеры реализации

### Проверка статуса аутентификации

```bash
# Проверить, требуется ли аутентификация
curl -X GET http://192.168.8.1/api/user/state-login
```

### Пример ввода PIN

```bash
# Ввести PIN (точная конечная точка зависит от прошивки)
curl -X POST http://192.168.8.1/api/pin/operate \
     -H "Content-Type: application/xml" \
     -d "<?xml version=\"1.0\" encoding=\"UTF-8\"?><request><OperType>0</OperType><CurrentPin>1234</CurrentPin></request>"
```

### Пример управления сессией

```bash
# Войти с учетными данными
curl -X POST http://192.168.8.1/api/user/login \
     -H "Content-Type: application/xml" \
     -d "<?xml version=\"1.0\" encoding=\"UTF-8\"?><request><Username>admin</Username><Password>password</Password></request>"
```

## Соображения интеграции

### Интеграция с ModemOpus

Security API интегрированы в ModemOpus через:

- **Middleware аутентификации**: Обработка входа в устройство
- **Управление PIN**: Операции разблокировки SIM
- **Отслеживание сессий**: Поддержание сессий устройства
- **Мониторинг безопасности**: Отслеживание попыток доступа
- **Обработка ошибок**: Корректная обработка ошибок безопасности

### Соображения разработки

1. **Восстановление после ошибок**: Реализуйте надежную обработку ошибок
2. **Логирование безопасности**: Правильно ведите журнал событий безопасности
3. **Управление учетными данными**: Безопасное хранение учетных данных
4. **Постоянство сессий**: Правильно обрабатывайте состояние сессий
5. **Обработка тайм-аутов**: Управляйте истечением сессий

### Развертывание в производстве

1. **Учетные данные по умолчанию**: Измените пароли по умолчанию
2. **Контроль доступа**: Реализуйте правильную аутентификацию
3. **Сетевая безопасность**: Обеспечьте безопасную сетевую среду
4. **Мониторинг**: Отслеживайте события безопасности
5. **Обновления**: Поддерживайте прошивку в актуальном состоянии

## Связанные API

- [Device API](device-RU.md) - Информация об устройстве и управление
- [User Management](system-RU.md) - Общесистемные настройки пользователей
- [Monitoring API](monitoring-RU.md) - Мониторинг событий безопасности

## Вариации прошивки

**Важно**: Реализации Security API значительно различаются между:

- Моделями устройств
- Версиями прошивки
- Региональными вариантами
- Настройками операторов

Всегда тестируйте функциональность безопасности с вашей конкретной моделью устройства и версией прошивки перед развертыванием в производстве.